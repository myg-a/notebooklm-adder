# NotebookLM Chrome拡張機能 要件定義書 v2.0

## 1. プロジェクト概要

### 1.1 目的
GoogleのNotebookLMに現在開いているブラウザ画面やページ内のリンクをソースとして効率的にインポートするChrome拡張機能を開発する。

### 1.2 背景
NotebookLMを使用する際に、現在閲覧中のページや関連リンクを手動でインポートするのは煩雑であり、より効率的な方法が求められている。

### 1.3 実装方針
既存のnotebooklm-importerの手法を参考に、NotebookLMの内部RPC APIを使用して実装する。

## 2. 機能要件

### 2.1 基本機能

#### 2.1.1 現在ページのインポート機能
- **機能**: 現在開いているページのURLを選択したノートブックにソースとして追加
- **入力**: 現在のページURL、選択したノートブック
- **出力**: NotebookLMへのソース追加完了
- **技術実装**: `chrome.tabs.query()` + `NotebookLMClient.addSource()`

#### 2.1.2 リンク一括インポート機能
- **機能**: 現在ページ内の全リンクを一覧表示し、チェックしたものを選択したノートブックに一括追加
- **入力**: ページ内の全リンクURL、ユーザーの選択、選択したノートブック
- **出力**: 選択されたリンクのNotebookLMへの一括追加完了
- **技術実装**: Content Script + `document.querySelectorAll('a[href]')` + `Promise.all()`

#### 2.1.3 新規ノートブック作成機能
- **機能**: 新規ノートブックを作成し、そこにソースを追加
- **入力**: ノートブック名（ページタイトル自動設定）、追加するURL
- **出力**: 新規ノートブック作成とソース追加完了
- **技術実装**: `NotebookLMClient.createNotebook()` + `addSource()`

### 2.2 UI/UX要件

#### 2.2.1 ポップアップUI構成
```
┌─────────────────────────────────┐
│ NotebookLM Importer             │
├─────────────────────────────────┤
│ [現在ページ] [リンク] [新規作成]  │
├─────────────────────────────────┤
│ ノートブック選択:                │
│ [ドロップダウン]                 │
│                                 │
│ [ノートブックに追加]             │
├─────────────────────────────────┤
│ ✅ 完了: ノートブックを開く       │
└─────────────────────────────────┘
```

#### 2.2.2 リンク表示UI
```
┌─────────────────────────────────┐
│ ページ内リンク (15件)            │
├─────────────────────────────────┤
│ ☑ リンク1 (example.com)         │
│ ☐ リンク2 (example2.com)        │
│ ☐ リンク3 (example3.com)        │
│ ...                             │
├─────────────────────────────────┤
│ [全選択] [全解除]               │
│ [選択した5件をインポート]        │
└─────────────────────────────────┘
```

#### 2.2.3 起動方法
- **メイン機能**: ツールバーアイコンクリック
- **対象ページ**: 全てのWebページ（制限なし）

## 3. 技術要件

### 3.1 実装技術スタック
- **ベースコード**: notebooklm-importer
- **フレームワーク**: React + TypeScript
- **ビルドツール**: Vite
- **テストフレームワーク**: Vitest + @testing-library/react
- **Chrome拡張**: Manifest V3

### 3.2 対応環境
- **ブラウザ**: Google Chrome（現行バージョン）
- **API**: NotebookLM内部RPC API（既存実装を活用）

### 3.3 Chrome拡張機能構成
```
manifest.json           # Chrome拡張設定
popup.html             # ポップアップUI
src/
├── popup/             # ポップアップ関連
│   ├── Popup.tsx      # メインコンポーネント
│   ├── Popup.test.tsx # テスト
│   └── popup.ts       # エントリーポイント
├── content/           # コンテンツスクリプト
│   ├── linkExtractor.ts
│   └── linkExtractor.test.ts
├── api/               # NotebookLM API関連
│   ├── NotebookLMClient.ts
│   ├── NotebookLMClient.test.ts
│   └── types.ts
└── utils/             # ユーティリティ
    ├── tabUtils.ts
    └── tabUtils.test.ts
```

### 3.4 データ形式
- **インポート形式**: URLそのものをソースとして追加
- **リンク検出**: `<a href>`タグから絶対URLを抽出
- **YouTube対応**: URLベースで特別処理

## 4. テスト要件

### 4.1 テスト戦略
- **TDD (Test-Driven Development)**: Red-Green-Refactor
- **ユニットテスト**: 各関数・コンポーネント
- **統合テスト**: Chrome拡張機能全体
- **E2Eテスト**: 実際のNotebookLMとの連携

### 4.2 テスト項目
1. **NotebookLMClient**
   - 認証情報取得
   - ノートブック一覧取得
   - ノートブック作成
   - ソース追加（単体・複数）

2. **UI コンポーネント**
   - ノートブック選択
   - リンク表示・選択
   - エラー表示
   - 成功表示

3. **Content Script**
   - リンク抽出
   - フィルタリング
   - URL正規化

4. **Chrome APIs**
   - アクティブタブ情報取得
   - 権限確認

## 5. 成功基準

### 5.1 機能面
- [ ] 現在ページのURLを1クリックでNotebookLMにインポート可能
- [ ] ページ内リンクを選択して一括インポート可能  
- [ ] 新規ノートブック作成とソース追加が連続で実行可能
- [ ] エラー時の適切なフィードバック表示

### 5.2 品質面
- [ ] テストカバレッジ 90%以上
- [ ] 全ユニットテスト合格
- [ ] E2Eテスト合格
- [ ] ESLintルール準拠

### 5.3 パフォーマンス面
- [ ] ポップアップ表示 1秒以内
- [ ] リンク抽出・表示 2秒以内
- [ ] 単体URL追加 3秒以内
- [ ] 10件一括追加 30秒以内

## 6. 開発フェーズ

### Phase 1: 基盤構築
1. プロジェクト初期化（TypeScript + Vite + Vitest）
2. Chrome拡張基本構造
3. NotebookLMClient基本実装

### Phase 2: 基本機能実装（TDD）
1. 現在ページインポート
2. ノートブック選択UI
3. 新規ノートブック作成

### Phase 3: 高度機能実装（TDD）
1. Content Scriptによるリンク抽出
2. リンク一括インポート
3. エラーハンドリング

### Phase 4: 統合・テスト
1. E2Eテスト
2. パフォーマンステスト
3. ユーザビリティテスト

## 7. 制約事項

### 7.1 技術制約
- NotebookLM内部API使用（非公式）
- Chrome拡張機能のセキュリティ制限
- NotebookLMの仕様変更リスク

### 7.2 機能制約
- NotebookLMログインが必要
- インターネット接続必須
- Chromeブラウザのみサポート

---

**作成日**: 2025年6月10日  
**バージョン**: 2.0  
**ステータス**: 実装準備完了